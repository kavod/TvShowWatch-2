<html>
    <head>
        <link type="text/css" rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
        <link type="text/css" href="//code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.css" rel="stylesheet" />
        <link type="text/css" href="css/TSW.css" rel="stylesheet" />
        <script type="text/javascript" src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
        <script type="text/javascript" src="//code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.js"></script>
        <script type="text/javascript" src="js/alpacaForm.js"></script>
    </head>
    <body>
    	<div class="container">
    		<div id="content">
				<ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
					<li class="active"><a href="#home" data-toggle="tab">Home</a></li>
					<li><a href="#tvshow" data-toggle="tab">TV Shows</a></li>
					<li><a href="#conf" data-toggle="tab">Configuration</a></li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="home">Home</div>
					<div class="tab-pane" id="tvshow">
						<h1>Add Tv Show</h1><br />
						<div id="search_tvshow"></div>
					</div>
					<div class="tab-pane container-fluid" id="conf">
						<div class="row">
							<ul id="tabs-conf" class="nav nav-pills nav-stacked col-sm-4" data-tabs="tabs">
								<li class="active"><a href="#torrent-search" data-toggle="tab">Torrents providers</a></li>
								<li><a href="#downloader" data-toggle="tab">Torrent client</a></li>
								<li><a href="#transfer" data-toggle="tab">Transfer method</a></li>
							</ul>
							<div class="tab-content col-sm-8">
								<div class="tab-pane active" id="torrent-search"></div>
								<div class="tab-pane" id="downloader"></div>
								<div class="tab-pane" id="transfer">Transfer</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	    </div>
        <script type="text/javascript">
            $(document).ready(function() {
				$("#tabs").tab();
				$("#tabs-conf").tab();
                $("#torrent-search").alpaca(alpacaForm("torrentSearch"));
                $("#downloader").alpaca(alpacaForm("downloader"));
                $("#transfer").alpaca(alpacaForm("transferer"));
                $("#tvshow").alpaca({
                	"dataSource":"/data/tvShowList/",
					"schemaSource": "/schema/tvShowList/",
					"options":{
						"type":"table",
						"items":{
							"fields":{
								"seriesid":{
									/*"view":"bootstrap-display",*/
									"validate":false
								},
								"status":{
									/*"view":"bootstrap-display",*/
									"validate":false
								},
								"season":{
									/*"view":"bootstrap-display",*/
									"validate":false
								},
								"episode":{
									/*"view":"bootstrap-display",*/
									"validate":false
								},
								"downloader_id": {
									"hidden":true
								}
							},
							/*"legendStyle":"hidden"*/
						},
						"hideInitValidationError":false
					},
					"view":"bootstrap-display"
                });
				
				// constructs the suggestion engine
				var states = new Bloodhound({
				  datumTokenizer: Bloodhound.tokenizers.whitespace,
				  queryTokenizer: Bloodhound.tokenizers.whitespace,
				  // `states` is an array of state names defined in "The Basics"
				  remote : {
				  	url:'/livesearch/%QUERY',
				  	wildcard: '%QUERY'
				  },
				});
				
                $("#search_tvshow").alpaca({
					"schema": {
						"type":"object",
						"properties": {
							"search": {
								"type": "string"
							}
						}
					},
					"options": {
						"fields": {
							"search": {
								"type": "search",
								"placeholder":"Type your favorite TV Show name",
								"events": {
									"keydown": function(e) {
										if (e.keyCode == '13')
										{
											$.ajax({
											  type: "POST",
											  url: "tvshowlist/add",
											  data: { "search": this.getValue() },
											});
										}
									}
								},
								"typeahead" : {
									"config": {
									  hint: true,
									  highlight: true,
									  minLength: 3
									},
									"datasets": {
									  name: 'states',
									  source: states.ttAdapter(),
									  displayKey: 'value',
									  limit: 9,
									  templates: {
									  	"suggestion":function(data) {
									  		return '<p>' + data.value + '<br />'
									  			 + '<small>' + data.info + '</small></p>';
									  	}
									  }
									}
								}
							}
						}
					}
				});
				
            });
        </script>
    </body>
</html>
